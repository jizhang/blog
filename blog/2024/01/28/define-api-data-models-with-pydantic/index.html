<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Define API Data Models with Pydantic | Ji ZHANG&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="In modern architecture, frontend and backend are separated and maintained by different teams. To cooperate, backend exposes services as API endpoints with carefully designed data models, for both requ">
<meta property="og:type" content="article">
<meta property="og:title" content="Define API Data Models with Pydantic">
<meta property="og:url" content="https://shzhangji.com/blog/2024/01/28/define-api-data-models-with-pydantic/index.html">
<meta property="og:site_name" content="Ji ZHANG&#39;s Blog">
<meta property="og:description" content="In modern architecture, frontend and backend are separated and maintained by different teams. To cooperate, backend exposes services as API endpoints with carefully designed data models, for both requ">
<meta property="og:locale">
<meta property="og:image" content="https://shzhangji.com/images/api-pydantic/pydantic.png">
<meta property="og:image" content="https://shzhangji.com/images/api-pydantic/openapi.png">
<meta property="article:published_time" content="2024-01-28T09:53:28.000Z">
<meta property="article:modified_time" content="2024-01-28T09:53:28.000Z">
<meta property="article:author" content="Ji ZHANG">
<meta property="article:tag" content="python">
<meta property="article:tag" content="openapi">
<meta property="article:tag" content="flask">
<meta property="article:tag" content="pydantic">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://shzhangji.com/images/api-pydantic/pydantic.png">
<meta name="twitter:creator" content="@zjerryj">
<link rel="publisher" href="zhangji87@gmail.com">
  
    <link rel="alternate" href="/atom.xml" title="Ji ZHANG&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="/css/source-code-pro.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  


  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-XGPVRTV36D"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-XGPVRTV36D');
  </script>
<meta name="generator" content="Hexo 6.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Ji ZHANG&#39;s Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">If I rest, I rust.</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/categories/Big-Data">Big Data</a>
        
          <a class="main-nav-link" href="/categories/Programming">Programming</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        <a id="nav-github" class="nav-icon" target="_blank" rel="noopener" href="https://github.com/jizhang" title="GitHub"></a>
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://shzhangji.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-define-api-data-models-with-pydantic" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2024/01/28/define-api-data-models-with-pydantic/" class="article-date">
  <time datetime="2024-01-28T09:53:28.000Z" itemprop="datePublished">2024-01-28</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Programming/">Programming</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Define API Data Models with Pydantic
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>In modern architecture, frontend and backend are separated and maintained by different teams. To cooperate, backend exposes services as API endpoints with carefully designed data models, for both request and response. In Python, there are numerous ways to complete this task, such as WTForms, marshmallow. There are also frameworks that are designed to build API server, like FastAPI, Connexion, both are built around OpenAPI specification. In this article, I will introduce <a target="_blank" rel="noopener" href="https://pydantic.dev/">Pydantic</a>, a validation and serialization library for Python, to build and enforce API request and response models. The web framework I choose is Flask, but Pydantic is framework-agnostic and can also be used in non-web applications.</p>
<p><img src="/images/api-pydantic/pydantic.png" alt="Pydantic"></p>
<h2 id="Define-response-model"><a href="#Define-response-model" class="headerlink" title="Define response model"></a>Define response model</h2><p>After <code>pip install pydantic</code>, let’s define a simple response model to return the currently logged-in user:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    <span class="built_in">id</span>: <span class="built_in">int</span></span><br><span class="line">    username: <span class="built_in">str</span></span><br><span class="line">    last_login: datetime</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&#x27;/current-user&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">current_user</span>() -&gt; <span class="built_in">dict</span>:</span><br><span class="line">    user = User(<span class="built_in">id</span>=<span class="number">1</span>, username=<span class="string">&#x27;jizhang&#x27;</span>, last_login=datetime.now())</span><br><span class="line">    <span class="keyword">return</span> user.model_dump(mode=<span class="string">&#x27;json&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>Then use httpie to test the API:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">% http localhost:5000/current-user</span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    &quot;id&quot;: 1,</span><br><span class="line">    &quot;username&quot;: &quot;jizhang&quot;,</span><br><span class="line">    &quot;last_login&quot;: &quot;2024-01-25T10:25:23.670431&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>We create Pydantic model by extending <code>BaseModel</code>, which is the basic approach. There are others ways like <code>dataclass</code>, <code>TypeAdapter</code>, or dynamic creation of models.</li>
<li>Model fields are simply defined by class attributes and type annotations. Unlike other SerDe libraries, Pydantic is natively built with Python type hints. If you are not familiar with it, please check out my previous <a href="https://shzhangji.com/blog/2024/01/19/python-static-type-check/">blog post</a>.</li>
<li>In the API, we manually create a model instance <code>user</code>. Usually we create them from request body or database models, which will be demonstrated later.</li>
<li>Then we serialize, or “dump” the model into a Python dict, that in turn is transformed by Flask into a JSON string. We can also use <code>user.model_dump_json()</code>, which returns the JSON string directly, but then the response header needs to be manually set to <code>application/json</code>, so we would rather let Flask do the job.</li>
<li><code>mode=&quot;json&quot;</code> tells Pydantic to serialize field values into JSON representable types. For instance, <code>datetime</code> and <code>Decimal</code> will be converted to string. Flask can also do this conversion, but we prefer keeping serialization in Pydantic model for clarity and ease of change.</li>
</ul>
<span id="more"></span>


<h3 id="Create-from-SQLAlchemy-model"><a href="#Create-from-SQLAlchemy-model" class="headerlink" title="Create from SQLAlchemy model"></a>Create from SQLAlchemy model</h3><p>Using model constructor to create instance is one way. We can also create from a Python dictionary:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user = User.model_validate(&#123;<span class="string">&#x27;id&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;username&#x27;</span>: <span class="string">&#x27;jizhang&#x27;</span>, <span class="string">&#x27;last_login&#x27;</span>: datetime.now()&#125;)</span><br></pre></td></tr></table></figure>

<p>Or an arbitrary class instance:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">UserDto</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, <span class="built_in">id</span>: <span class="built_in">int</span>, username: <span class="built_in">str</span>, last_login: datetime</span>):</span><br><span class="line">        self.<span class="built_in">id</span> = <span class="built_in">id</span></span><br><span class="line">        self.username = username</span><br><span class="line">        self.last_login = last_login</span><br><span class="line"></span><br><span class="line">user = User.model_validate(UserDto(<span class="number">1</span>, <span class="string">&#x27;jizhang&#x27;</span>, datetime.now()), from_attributes=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p><code>UserDto</code> can also be a Python dataclass. You may notice the <code>from_attributes</code> parameter, which means field values are extracted from object’s attributes, instead of dictionary key value pairs. If the model is always created from objects, we can add this configuration to the model:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    model_config = ConfigDict(from_attributes=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">id</span>: <span class="built_in">int</span></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">user = User.model_validate(user_dto)</span><br></pre></td></tr></table></figure>

<p>This is actually how we integrate with SQLAlchemy, creating Pydantic model instance from SQLAlchemy model instance:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sqlalchemy.orm <span class="keyword">import</span> Mapped, mapped_column</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserOrm</span>(<span class="title class_ inherited__">Base</span>):</span><br><span class="line">    __tablename__ = <span class="string">&#x27;user&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">id</span>: Mapped[<span class="built_in">int</span>] = mapped_column(primary_key=<span class="literal">True</span>)</span><br><span class="line">    username: Mapped[<span class="built_in">str</span>]</span><br><span class="line">    password: Mapped[<span class="built_in">str</span>]</span><br><span class="line">    last_login: Mapped[datetime]</span><br><span class="line"></span><br><span class="line">user_orm = db.session.get_one(UserOrm, <span class="number">1</span>)</span><br><span class="line">user = User.model_validate(user_orm)</span><br></pre></td></tr></table></figure>

<p>Would it be nice if our model is both Pydantic model <em>and</em> SQLAlchemy model? <a target="_blank" rel="noopener" href="https://sqlmodel.tiangolo.com/">SQLModel</a> is exactly designed for this purpose:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sqlmodel <span class="keyword">import</span> SQLModel, Field</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>(SQLModel, table=<span class="literal">True</span>):</span><br><span class="line">    <span class="built_in">id</span>: <span class="type">Optional</span>[<span class="built_in">int</span>] = Field(default=<span class="literal">None</span>, primary_key=<span class="literal">True</span>)</span><br><span class="line">    username: <span class="built_in">str</span></span><br><span class="line">    last_login: datetime</span><br><span class="line"></span><br><span class="line"><span class="comment"># Read from database</span></span><br><span class="line">user = db.session.get_one(User, <span class="number">1</span>)</span><br><span class="line">user.model_dump(mode=<span class="string">&#x27;json&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create from request data</span></span><br><span class="line">user = User.model_validate(request.get_json())</span><br><span class="line">db.session.add(user)</span><br></pre></td></tr></table></figure>

<p>But personally I am not in favor of this approach, for it mixes classes from two layers, domain layer and presentation layer. Now the class has two reasons to change, thus violating the single responsibility principle. Use it judiciously.</p>
<h3 id="Nested-models"><a href="#Nested-models" class="headerlink" title="Nested models"></a>Nested models</h3><p>To return a list of users, we can either create a dedicated response model:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">UserListResponse</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    users: <span class="built_in">list</span>[User]</span><br><span class="line"></span><br><span class="line">user_orms = user_svc.get_list()</span><br><span class="line">response = UserListResponse(users=user_orms)</span><br><span class="line">response.model_dump(mode=<span class="string">&#x27;json&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>Or, if you prefer to return a list, we can create a custom type with <code>TypeAdapter</code>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> TypeAdapter</span><br><span class="line"></span><br><span class="line">UserList = TypeAdapter(<span class="built_in">list</span>[User])</span><br><span class="line"></span><br><span class="line">user_orms = user_svc.get_list()</span><br><span class="line">user_list = UserList.validate_python(user_orms)</span><br><span class="line">UserList.dump_python(user_list, mode=<span class="string">&#x27;json&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>I recommend the first approach, since it would be easier to add model attributes in the future.</p>
<h3 id="Custom-serialization"><a href="#Custom-serialization" class="headerlink" title="Custom serialization"></a>Custom serialization</h3><p>By default, <code>datetime</code> object is serialized into ISO 8601 string. If you prefer a different representation, custom serializers can be added. There are several ways to accomplish this task. Decorate a class method with <code>field_serializer</code>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> field_serializer</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    last_login: datetime</span><br><span class="line"></span><br><span class="line"><span class="meta">    @field_serializer(<span class="params"><span class="string">&#x27;last_login&#x27;</span></span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">serialize_last_login</span>(<span class="params">self, value: datetime</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">return</span> value.strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>Create a new type with custom serializer:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Annotated</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> PlainSerializer</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">format_datetime</span>(<span class="params">dt: datetime</span>):</span><br><span class="line">    <span class="keyword">return</span> dt.strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>)</span><br><span class="line"></span><br><span class="line">CustomDatetime = Annotated[datetime, PlainSerializer(format_datetime)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    last_login: CustomDatetime</span><br></pre></td></tr></table></figure>

<p><code>Annotated</code> is widely used in Pydantic, to attach extra information like custom serialization and validation to an existing type. In this example, we use a <code>PlainSerializer</code>, which takes a function or lambda to serialize the field. There is also a <code>WrapSerializer</code>, that can be used to apply transformation before and after the default serializer.</p>
<p>Finally, there is the <code>model_serializer</code> decorator that can be used to transform the whole model, as well as individual fields.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> model_serializer</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    <span class="built_in">id</span>: <span class="built_in">int</span></span><br><span class="line">    last_login: datetime</span><br><span class="line"></span><br><span class="line"><span class="meta">    @model_serializer</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">serialize_model</span>(<span class="params">self</span>) -&gt; <span class="built_in">dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]:</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&#x27;id&#x27;</span>: self.<span class="built_in">id</span>,</span><br><span class="line">            <span class="string">&#x27;last_login&#x27;</span>: self.last_login.strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>),</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserListResponse</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    users: <span class="built_in">list</span>[User]</span><br><span class="line"></span><br><span class="line"><span class="meta">    @model_serializer</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">serialize_model</span>(<span class="params">self</span>) -&gt; <span class="built_in">list</span>:</span><br><span class="line">        <span class="keyword">return</span> self.users</span><br></pre></td></tr></table></figure>

<p>Now <code>UserListResponse</code> will be dumped into a list, instead of a dictionary.</p>
<h3 id="Field-alias"><a href="#Field-alias" class="headerlink" title="Field alias"></a>Field alias</h3><p>Sometimes we want to change the key name in serialized data. For instance, change <code>users</code> to <code>userList</code>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> Field</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserListResponse</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    users: <span class="built_in">list</span>[User] = Field(serialization_alias=<span class="string">&#x27;userList&#x27;</span>)</span><br><span class="line"></span><br><span class="line">response = UserListResponse(users=user_orms)</span><br><span class="line">response.model_dump(mode=<span class="string">&#x27;json&#x27;</span>, by_alias=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># &#123;&quot;userList&quot;: []&#125;</span></span><br></pre></td></tr></table></figure>

<p><code>serialization_alias</code> indicates that the alias is only used for serialization. When creating models, we still use <code>users</code> as the key. To change both keys to <code>userList</code>, use <code>Field(alias=&#39;userList&#39;)</code>. If this conversion is universal, say you want all your request and response data to use camelCase for keys, add these configurations to your model:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pydantic.alias_generators <span class="keyword">import</span> to_camel</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserListResponse</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    model_config = ConfigDict(alias_generator=to_camel, populate_by_name=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    user_list: <span class="built_in">list</span>[User]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create from request data</span></span><br><span class="line">UserListResponse.model_validate(&#123;<span class="string">&#x27;userList&#x27;</span>: []&#125;)</span><br><span class="line"><span class="comment"># This still works</span></span><br><span class="line">UserListResponse(user_list=[])</span><br><span class="line"></span><br><span class="line"><span class="comment"># Dump to response data</span></span><br><span class="line">response.model_dump(mode=<span class="string">&#x27;json&#x27;</span>, by_alias=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># &#123;&quot;userList&quot;: []&#125;</span></span><br></pre></td></tr></table></figure>


<h3 id="Computed-fields"><a href="#Computed-fields" class="headerlink" title="Computed fields"></a>Computed fields</h3><p>Fields may derive from other fields:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> url_for</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> computed_field</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Article</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    <span class="built_in">id</span>: <span class="built_in">int</span></span><br><span class="line">    title: <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @computed_field  </span><span class="comment"># type: ignore[misc]</span></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">link</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">return</span> url_for(<span class="string">&#x27;article&#x27;</span>, <span class="built_in">id</span>=self.<span class="built_in">id</span>)</span><br></pre></td></tr></table></figure>

<p>If the field requires extra information, we can add a private attribute to the model. The attribute’s name starts with an underscore, and Pydantic will ignore it in serialization and validation.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> PrivateAttr</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Article</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    category_id: <span class="built_in">int</span></span><br><span class="line">    _categories: <span class="built_in">dict</span>[<span class="built_in">int</span>, <span class="built_in">str</span>] = PrivateAttr(default_factory=<span class="built_in">dict</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @computed_field  </span><span class="comment"># type: ignore[misc]</span></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">category_name</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">return</span> self._categories.get(self.category_id, <span class="string">&#x27;N/A&#x27;</span>)</span><br><span class="line"></span><br><span class="line">article = Article(category_id=<span class="number">1</span>)</span><br><span class="line">article._categories = &#123;<span class="number">1</span>: <span class="string">&#x27;Big Data&#x27;</span>&#125;</span><br><span class="line">article.model_dump(mode=<span class="string">&#x27;json&#x27;</span>)</span><br><span class="line"><span class="comment"># &#123;&quot;category_id&quot;: 1, &quot;category_name&quot;: &quot;Big Data&quot;&#125;</span></span><br></pre></td></tr></table></figure>


<h2 id="Define-request-model"><a href="#Define-request-model" class="headerlink" title="Define request model"></a>Define request model</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> Field</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserForm</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    username: <span class="built_in">str</span></span><br><span class="line">    password: <span class="built_in">str</span> = Field(exclude=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CreateUserResponse</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    <span class="built_in">id</span>: <span class="built_in">int</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&#x27;/create-user&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_user</span>() -&gt; <span class="built_in">dict</span>:</span><br><span class="line">    form = UserForm.model_validate(request.get_json())</span><br><span class="line">    user_orm = UserOrm(**<span class="built_in">dict</span>(form), last_login=datetime.now())</span><br><span class="line">    db.session.add(user_orm)</span><br><span class="line">    db.session.commit()</span><br><span class="line"></span><br><span class="line">    response = CreateUserResponse(<span class="built_in">id</span>=user_orm.<span class="built_in">id</span>)</span><br><span class="line">    <span class="keyword">return</span> response.model_dump(mode=<span class="string">&#x27;json&#x27;</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li><code>model_validate</code> takes the dictionary returned by <code>get_json</code>, validates it, and constructs a model instance. There is also a <code>model_validate_json</code> method that accepts JSON string.</li>
<li>The validated form data is then passed to an ORM model. Usually this is done by manual assignments, because fields like <code>password</code> need to be properly encrypted.</li>
<li><code>Field(exclude=True)</code> indicates that this field will be excluded in serialization. This is helpful when you do not want some information leaking to the client.</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">% http localhost:5000/create-user username=jizhang password=password</span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    &quot;id&quot;: 3</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Query parameters can be modeled in a similar way:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SearchForm</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    tags: <span class="built_in">str</span></span><br><span class="line">    keyword: <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&#x27;/article/search&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">article_search</span>() -&gt; <span class="built_in">dict</span>:</span><br><span class="line">    form = SearchForm.model_validate(request.args.to_dict())</span><br><span class="line">    <span class="keyword">return</span> form.model_dump(mode=<span class="string">&#x27;json&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>Use <code>==</code> to tell httpie to use GET method:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">% http localhost:5000/article/search tags==a,b,c keyword==test</span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    &quot;keyword&quot;: &quot;test&quot;,</span><br><span class="line">    &quot;tags&quot;: &quot;a,b,c&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="Custom-deserialization"><a href="#Custom-deserialization" class="headerlink" title="Custom deserialization"></a>Custom deserialization</h3><p>Let’s see how to parse <code>tags</code> string to a list of tags:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SearchForm</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    tags: <span class="built_in">list</span>[<span class="built_in">str</span>]</span><br><span class="line">    keyword: <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @field_validator(<span class="params"><span class="string">&#x27;tags&#x27;</span>, mode=<span class="string">&#x27;before&#x27;</span></span>)</span></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">validate_tags</span>(<span class="params">cls, value: <span class="built_in">str</span></span>) -&gt; <span class="built_in">list</span>[<span class="built_in">str</span>]:</span><br><span class="line">        <span class="keyword">return</span> value.split(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line"></span><br><span class="line">form = SearchForm.model_validate(request.args.to_dict())</span><br><span class="line"><span class="built_in">print</span>(form.tags)</span><br><span class="line"><span class="comment"># [&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;]</span></span><br></pre></td></tr></table></figure>

<p><code>field_validator</code> is used to compose custom validation rules, which will be discussed in a later section. Normally it executes after Pydantic has done the default validation. In this case, <code>tags</code> is declared as <code>list[str]</code> and Pydantic would raise an error when a string is passed to it. So we use <code>mode=&#39;before&#39;</code> to apply this function on the raw input data, and transform it into a list of tags.</p>
<p>There are also annotated validator and <code>model_validator</code>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BeforeValidator</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse_tags</span>(<span class="params">tags: <span class="built_in">str</span></span>) -&gt; <span class="built_in">list</span>[<span class="built_in">str</span>]:</span><br><span class="line">    <span class="keyword">return</span> tags.split(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line"></span><br><span class="line">TagList = Annotated[<span class="built_in">list</span>[<span class="built_in">str</span>], BeforeValidator(parse_tags)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SearchForm</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    tags: TagList</span><br><span class="line">    keyword: <span class="type">Optional</span>[<span class="built_in">str</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">    @model_validator(<span class="params">mode=<span class="string">&#x27;before&#x27;</span></span>)</span></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">validate_model</span>(<span class="params">cls, data: <span class="built_in">dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]</span>) -&gt; <span class="built_in">dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> data[<span class="string">&#x27;keyword&#x27;</span>].strip():</span><br><span class="line">            data[<span class="string">&#x27;keyword&#x27;</span>] = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">return</span> data</span><br></pre></td></tr></table></figure>


<h3 id="Required-field-and-default-value"><a href="#Required-field-and-default-value" class="headerlink" title="Required field and default value"></a>Required field and default value</h3><p>By default, all model attributes are required. Though <code>keyword</code> is defined as <code>Optional</code>, Pydantic will still raise an error if <code>keyword</code> is missing in the input data.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SearchForm.model_validate_json(<span class="string">&#x27;&#123;&quot;tags&quot;: &quot;a,b,c&quot;&#125;&#x27;</span>)</span><br><span class="line"><span class="comment"># ValidationError keyword Field required</span></span><br><span class="line"></span><br><span class="line">form = SearchForm.model_validate_json(<span class="string">&#x27;&#123;&quot;tags&quot;: &quot;a,b,c&quot;, &quot;keyword&quot;: null&#125;&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(form.keyword)</span><br><span class="line"><span class="comment"># None</span></span><br></pre></td></tr></table></figure>

<p>There are several ways to provide a default value for missing keys:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Optional</span>, Annotated</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">from</span> uuid <span class="keyword">import</span> uuid4</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> Field</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SearchForm</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    keyword_1: <span class="type">Optional</span>[<span class="built_in">str</span>] = <span class="literal">None</span></span><br><span class="line">    keyword_2: <span class="type">Optional</span>[<span class="built_in">str</span>] = Field(default=<span class="literal">None</span>)</span><br><span class="line">    keyword_3: Annotated[<span class="type">Optional</span>[<span class="built_in">str</span>], Field(default=<span class="literal">None</span>)]</span><br><span class="line"></span><br><span class="line">    tags: <span class="built_in">list</span>[<span class="built_in">str</span>] = Field(default_factory=<span class="built_in">list</span>)</span><br><span class="line">    create_time: datetime = Field(default_factory=datetime.now)</span><br><span class="line">    uuid: <span class="built_in">str</span> = Field(default_factory=<span class="keyword">lambda</span>: uuid4().<span class="built_in">hex</span>)</span><br><span class="line"></span><br><span class="line">    tag_list: <span class="built_in">list</span>[<span class="built_in">str</span>] = []  <span class="comment"># This is OK</span></span><br></pre></td></tr></table></figure>

<p><code>default_factory</code> is useful when the default value is dynamically generated. For <code>list</code> and <code>dict</code>, it is okay to use literals <code>[]</code> and <code>&#123;&#125;</code>, because Pydantic will make a deep copy of it.</p>
<h3 id="Type-conversion"><a href="#Type-conversion" class="headerlink" title="Type conversion"></a>Type conversion</h3><p>For GET requests, input data are always of type <code>dict[str, str]</code>. For POST requests, though the client could send different types of values via JSON, like boolean and number, there are some types that are not representable in JSON, datetime for an example. When creating models, Pydantic will do proper type conversion. It is actually a part of validation, to ensure the client provides the correct data.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ConversionForm</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    int_value: <span class="built_in">int</span></span><br><span class="line">    decimal_value: Decimal</span><br><span class="line">    bool_value: <span class="built_in">bool</span></span><br><span class="line">    datetime_value: datetime</span><br><span class="line">    array_value: <span class="built_in">list</span>[<span class="built_in">int</span>]</span><br><span class="line">    object_value: <span class="built_in">dict</span>[<span class="built_in">str</span>, <span class="built_in">int</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Validate data returned by request.get_json()</span></span><br><span class="line">ConversionForm.model_validate(&#123;</span><br><span class="line">    <span class="string">&#x27;int_value&#x27;</span>: <span class="string">&#x27;10&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;decimal_value&#x27;</span>: <span class="string">&#x27;10.24&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;bool_value&#x27;</span>: <span class="string">&#x27;true&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;datetime_value&#x27;</span>: <span class="string">&#x27;2024-01-27 17:02:00&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;array_value&#x27;</span>: [<span class="number">1</span>, <span class="string">&#x27;2&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;object_value&#x27;</span>: &#123;<span class="string">&#x27;key&#x27;</span>: <span class="string">&#x27;10&#x27;</span>&#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>As a side note, if you are to create model with constructor, and pass a data type that does not match the model definition, mypy will raise an error:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ConversionForm(int_value=<span class="string">&#x27;10&#x27;</span>)</span><br><span class="line"><span class="comment"># error: Argument &quot;int_value&quot; to &quot;ConversionForm&quot; has incompatible type &quot;str&quot;; expected &quot;int&quot;</span></span><br></pre></td></tr></table></figure>

<p>To fix this, you need to enable Pydantic’s mypy plugin in <code>pyproject.toml</code>:</p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[tool.mypy]</span></span><br><span class="line"><span class="attr">plugins</span> = [</span><br><span class="line">    <span class="string">&#x27;pydantic.mypy&#x27;</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>


<h2 id="Data-validation"><a href="#Data-validation" class="headerlink" title="Data validation"></a>Data validation</h2><p>Type conversion works as the first step of data validation. Pydantic makes sure the model it creates contains attributes with the correct type. For further validation, Pydantic provides some builtin validators, and users are free to create new ones.</p>
<h3 id="Builtin-validators"><a href="#Builtin-validators" class="headerlink" title="Builtin validators"></a>Builtin validators</h3><p>Here are three ways to ensure <code>username</code> contains 3 to 10 characters, with builtin validators:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Field definition</span></span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel, Field</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserForm</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    username: <span class="built_in">str</span> = Field(min_length=<span class="number">3</span>, max_length=<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Annotated type</span></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Annotated</span><br><span class="line"></span><br><span class="line">ValidName = Annotated[<span class="built_in">str</span>, Field(min_length=<span class="number">3</span>, max_length=<span class="number">10</span>)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserForm</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    username: ValidName</span><br><span class="line"></span><br><span class="line"><span class="comment"># Use annotated-types package, auto-installed by Pydantic</span></span><br><span class="line"><span class="keyword">from</span> annotated_types <span class="keyword">import</span> MinLen, MaxLen, Len</span><br><span class="line"></span><br><span class="line">ValidName = Annotated[<span class="built_in">str</span>, MinLen(<span class="number">3</span>), MaxLen(<span class="number">10</span>)]</span><br><span class="line"><span class="comment"># Or</span></span><br><span class="line">ValidName = Annotated[<span class="built_in">str</span>, Len(<span class="number">3</span>, <span class="number">10</span>)]</span><br></pre></td></tr></table></figure>

<p>Some useful builtin validators are listed below. For annotated-types package, please check its <a target="_blank" rel="noopener" href="https://github.com/annotated-types/annotated-types">repository</a> for more.</p>
<ul>
<li>String constraints<ul>
<li><code>min_length</code></li>
<li><code>max_length</code></li>
<li><code>pattern</code>: Regular expression, e.g. <code>r&#39;^[0-9]+$&#39;</code></li>
</ul>
</li>
<li>Numeric constraints<ul>
<li><code>gt</code>: Greater than</li>
<li><code>lt</code>: Less than</li>
<li><code>ge</code>: Greater than or equal to</li>
<li><code>le</code>: Less than or equal to</li>
</ul>
</li>
<li>Decimal constraints<ul>
<li><code>max_digits</code></li>
<li><code>decimal_places</code></li>
</ul>
</li>
</ul>
<p>In addition, Pydantic defines several special types for validation. For instance:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> PostiveInt</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Model</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    int_1: PositiveInt</span><br><span class="line">    int_2: Annotated[<span class="built_in">int</span>, Field(gt=<span class="number">0</span>)]</span><br></pre></td></tr></table></figure>

<p><code>int_1</code> and <code>int_2</code> are equivalent, they both accept integer that is greater than 0. Other useful predefined types are:</p>
<ul>
<li><code>NegativeInt</code>, <code>NonPositiveInt</code>, <code>NonNegativeFloat</code>, etc.</li>
<li><code>StrictInt</code>: Only accept integer value like <code>10</code>, <code>-20</code>. Raise error for string <code>&quot;10&quot;</code> or float <code>10.0</code>. <a target="_blank" rel="noopener" href="https://docs.pydantic.dev/latest/concepts/strict_mode/">Strict mode</a> can be enabled on field level, model level, or per validation.</li>
<li><code>AwareDatetime</code>: Datetime must contain timezone information, e.g. <code>2024-01-28T07:58:00+08:00</code></li>
<li><code>AnyUrl</code>: Accept a valid URL, and user can access properties like <code>scheme</code>, <code>host</code>, <code>path</code>, etc.</li>
<li><code>Emailstr</code>: Accept a valid email address. This requires an extra package, i.e. <code>pip intall &quot;pydantic[email]&quot;</code></li>
<li><code>IPvAnyAddress</code>: Accept a valid IPv4 or IPv6 address.</li>
<li><code>Json</code>: Accept a JSON string and convert it to Python object. For example:</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> Json</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SearchForm</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    tags: Json[<span class="built_in">list</span>[<span class="built_in">str</span>]]</span><br><span class="line"></span><br><span class="line">form = SearchForm(tags=<span class="string">&#x27;[&quot;a&quot;, &quot;b&quot;, &quot;c&quot;]&#x27;</span>)</span><br><span class="line">form.model_dump(mode=<span class="string">&#x27;json&#x27;</span>)</span><br><span class="line"><span class="comment"># &#123;&quot;tags&quot;: [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;]&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="Choices"><a href="#Choices" class="headerlink" title="Choices"></a>Choices</h3><p>Another common use case for validation is to only accept certain values for a field. This can be done with <code>Literal</code> type:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Literal</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SearchForm</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    order_by: <span class="type">Literal</span>[<span class="string">&#x27;asc&#x27;</span>, <span class="string">&#x27;desc&#x27;</span>] = <span class="string">&#x27;asc&#x27;</span></span><br><span class="line"></span><br><span class="line">SearchForm(order_by=<span class="string">&#x27;natural&#x27;</span>)</span><br><span class="line"><span class="comment"># ValidationError order_by Input should be &#x27;asc&#x27; or &#x27;desc&#x27;</span></span><br></pre></td></tr></table></figure>

<p>Or <code>Enum</code>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> enum <span class="keyword">import</span> Enum</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OrderBy</span>(<span class="built_in">str</span>, Enum):</span><br><span class="line">    ASC = <span class="string">&#x27;asc&#x27;</span></span><br><span class="line">    DESC = <span class="string">&#x27;desc&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Category</span>(<span class="title class_ inherited__">IntEnum</span>):</span><br><span class="line">    BIG_DATA = <span class="number">1</span></span><br><span class="line">    PROGRAMMING = <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SearchForm</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    order_by: OrderBy</span><br><span class="line">    category: Category</span><br><span class="line"></span><br><span class="line">form = SearchForm(order_by=<span class="string">&#x27;asc&#x27;</span>, category=<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line"><span class="keyword">assert</span> form.order_by == OrderBy.ASC</span><br><span class="line"><span class="keyword">assert</span> form.category == Category.PROGRAMMING</span><br></pre></td></tr></table></figure>

<h3 id="Custom-validator"><a href="#Custom-validator" class="headerlink" title="Custom validator"></a>Custom validator</h3><p>As shown in the previous section, there are three ways to define a validator. But this time we want to apply custom logics <em>after</em> the default validation.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Field decorator</span></span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> field_validator</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserForm</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    username: <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @field_validator(<span class="params"><span class="string">&#x27;username&#x27;</span></span>)</span></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">validate_username</span>(<span class="params">cls, value: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(value) &lt; <span class="number">3</span> <span class="keyword">or</span> <span class="built_in">len</span>(value) &gt; <span class="number">10</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&#x27;should have 3 to 10 characters&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line"></span><br><span class="line"><span class="comment"># Annotated type</span></span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> AfterValidator</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">validate_name</span>(<span class="params">value: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(value) &lt; <span class="number">3</span> <span class="keyword">or</span> <span class="built_in">len</span>(value) &gt; <span class="number">10</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&#x27;should have 3 to 10 characters&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> value</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserForm</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    username: Annotated[<span class="built_in">str</span>, AfterValidator(validate_name)]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Model validator</span></span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> model_validator</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserForm</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    username: <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @model_validator(<span class="params">mode=<span class="string">&#x27;after&#x27;</span></span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">validate_model</span>(<span class="params">self</span>) -&gt; <span class="string">&#x27;UserForm&#x27;</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(self.username) &lt; <span class="number">3</span> <span class="keyword">or</span> <span class="built_in">len</span>(self.username) &gt; <span class="number">10</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&#x27;username should have 3 to 10 characters&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> self</span><br></pre></td></tr></table></figure>


<h2 id="Handle-validation-error"><a href="#Handle-validation-error" class="headerlink" title="Handle validation error"></a>Handle validation error</h2><p>All validation errors, including the <code>ValueError</code> we raise in custom validator, are wrapped in Pydantic’s <code>ValidationError</code>. So a common practice is to setup a global error handler for it. Take Flask for an instance:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Response, jsonfiy</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> ValidationError</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.errorhandler(<span class="params">ValidationError</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">handle_validation_error</span>(<span class="params">error: ValidationError</span>) -&gt; <span class="built_in">tuple</span>[Response, <span class="built_in">int</span>]:</span><br><span class="line">    detail = error.errors()[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">if</span> detail[<span class="string">&#x27;loc&#x27;</span>]:</span><br><span class="line">        message = <span class="string">f&#x27;<span class="subst">&#123;detail[<span class="string">&quot;loc&quot;</span>][<span class="number">0</span>]&#125;</span>: <span class="subst">&#123;detail[<span class="string">&quot;msg&quot;</span>]&#125;</span>&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        message = detail[<span class="string">&#x27;msg&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    payload = &#123;</span><br><span class="line">        <span class="string">&#x27;code&#x27;</span>: <span class="number">400</span>,</span><br><span class="line">        <span class="string">&#x27;message&#x27;</span>: message,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> jsonify(payload), <span class="number">400</span></span><br></pre></td></tr></table></figure>

<p><code>ValidationError</code> provides full description of all errors. Here we only take the first error and return the field name and error message:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">% http localhost:5000/create-user username=a password=password</span><br><span class="line">HTTP/1.1 400 BAD REQUEST</span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    &quot;code&quot;: 400,</span><br><span class="line">    &quot;message&quot;: &quot;username: Value error, should have 3 to 10 characters&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>To further customize the validation error, one can construct a <code>PydanticCustomError</code>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># In field validator</span></span><br><span class="line"><span class="keyword">raise</span> PydanticCustomError(<span class="string">&#x27;bad_request&#x27;</span>, <span class="string">&#x27;Invalid username&#x27;</span>, &#123;<span class="string">&#x27;code&#x27;</span>: <span class="number">40001</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># In error handler</span></span><br><span class="line"><span class="keyword">if</span> detail[<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;bad_request&#x27;</span>:</span><br><span class="line">    payload = &#123;</span><br><span class="line">        <span class="string">&#x27;code&#x27;</span>: detail[<span class="string">&#x27;ctx&#x27;</span>][<span class="string">&#x27;code&#x27;</span>],</span><br><span class="line">        <span class="string">&#x27;message&#x27;</span>: detail[<span class="string">&#x27;msg&#x27;</span>],</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>


<h3 id="Validate-routing-variables"><a href="#Validate-routing-variables" class="headerlink" title="Validate routing variables"></a>Validate routing variables</h3><p>Pydantic provides a decorator to validate function calls. This can be used to validate Flask’s routing variables as well. For instance, Flask accepts non-negative integer, but Pydantic requires it to be greater than 0.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> validate_call, PositiveInt</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&#x27;/user/&lt;int:user_id&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="meta">@validate_call</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_user_by_id</span>(<span class="params">user_id: PositiveInt</span>) -&gt; <span class="built_in">dict</span>:</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&#x27;id&#x27;</span>: user_id&#125;</span><br></pre></td></tr></table></figure>

<p>Validation result:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">% http localhost:5000/user/0</span><br><span class="line">HTTP/1.1 400 BAD REQUEST</span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    &quot;code&quot;: 400,</span><br><span class="line">    &quot;message&quot;: &quot;user_id: Input should be greater than 0&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="Integrate-with-OpenAPI"><a href="#Integrate-with-OpenAPI" class="headerlink" title="Integrate with OpenAPI"></a>Integrate with OpenAPI</h2><p>The quickest way is to use a framework that builds with Pydantic and OpenAPI, a.k.a. <a target="_blank" rel="noopener" href="https://fastapi.tiangolo.com/">FastAPI</a>. But if you are using a different framework, or maintaining an existing project, there are several options.</p>
<h3 id="Export-model-to-JSON-schema"><a href="#Export-model-to-JSON-schema" class="headerlink" title="Export model to JSON schema"></a>Export model to JSON schema</h3><p>Pydantic provides the facility to export models as JSON schema. We can write a Flask command to save them into a file:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pydantic.json_schema <span class="keyword">import</span> models_json_schema</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.cli.command()</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">export_schema</span>():</span><br><span class="line">    _, schema = models_json_schema([</span><br><span class="line">        (UserForm, <span class="string">&#x27;validation&#x27;</span>),</span><br><span class="line">        (CreateUserResponse, <span class="string">&#x27;serialization&#x27;</span>),</span><br><span class="line">    ])</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;schemas.json&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(json.dumps(schema, indent=<span class="number">2</span>))</span><br></pre></td></tr></table></figure>

<p>The generated <code>schemas.json</code> would be:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;$defs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;UserForm&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;object&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;maxLength&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;minLength&quot;</span><span class="punctuation">:</span> <span class="number">3</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        ...</span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    ...</span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>Then we create an <code>openapi.yaml</code> file to use these schemas:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">openapi:</span> <span class="number">3.0</span><span class="number">.2</span></span><br><span class="line"><span class="attr">info:</span></span><br><span class="line">  <span class="attr">title:</span> <span class="string">Pydantic</span> <span class="string">Demo</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">0.1</span><span class="number">.0</span></span><br><span class="line"><span class="attr">paths:</span></span><br><span class="line">  <span class="string">/create-user:</span></span><br><span class="line">    <span class="attr">post:</span></span><br><span class="line">      <span class="attr">requestBody:</span></span><br><span class="line">        <span class="attr">content:</span></span><br><span class="line">          <span class="attr">application/json:</span></span><br><span class="line">            <span class="attr">schema:</span></span><br><span class="line">              <span class="string">$ref:</span> <span class="string">&#x27;schemas.json#/$defs/UserForm&#x27;</span></span><br><span class="line">      <span class="attr">responses:</span></span><br><span class="line">        <span class="attr">&#x27;200&#x27;:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">OK</span></span><br><span class="line">          <span class="attr">content:</span></span><br><span class="line">            <span class="attr">application/json:</span></span><br><span class="line">              <span class="attr">schema:</span></span><br><span class="line">                <span class="string">$ref:</span> <span class="string">&#x27;schemas.json#/$defs/CreateUserResponse&#x27;</span></span><br></pre></td></tr></table></figure>

<p>Open it in some OpenAPI viewer, e.g. OpenAPI extension for VS Code:</p>
<p><img src="/images/api-pydantic/openapi.png" alt="OpenAPI"></p>
<h3 id="Create-OpenAPI-specification-in-Python"><a href="#Create-OpenAPI-specification-in-Python" class="headerlink" title="Create OpenAPI specification in Python"></a>Create OpenAPI specification in Python</h3><p>Install <a target="_blank" rel="noopener" href="https://github.com/mike-oakley/openapi-pydantic">openapi-pydantic</a>, and define OpenAPI like a Pydantic model:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> openapi_pydantic <span class="keyword">import</span> OpenAPI</span><br><span class="line"><span class="keyword">from</span> openapi_pydantic.util <span class="keyword">import</span> PydanticSchema, construct_open_api_with_schema_class</span><br><span class="line"></span><br><span class="line">api = OpenAPI.model_validate(&#123;</span><br><span class="line">    <span class="string">&#x27;info&#x27;</span>: &#123;<span class="string">&#x27;title&#x27;</span>: <span class="string">&#x27;Pydantic Demo&#x27;</span>, <span class="string">&#x27;version&#x27;</span>: <span class="string">&#x27;0.1.0&#x27;</span>&#125;,</span><br><span class="line">    <span class="string">&#x27;paths&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;/create-user&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;post&#x27;</span>: &#123;</span><br><span class="line">                <span class="string">&#x27;requestBody&#x27;</span>: &#123;<span class="string">&#x27;content&#x27;</span>: &#123;<span class="string">&#x27;application/json&#x27;</span>: &#123;</span><br><span class="line">                    <span class="string">&#x27;schema&#x27;</span>: PydanticSchema(schema_class=UserForm),</span><br><span class="line">                &#125;&#125;&#125;,</span><br><span class="line">                <span class="string">&#x27;responses&#x27;</span>: &#123;<span class="string">&#x27;200&#x27;</span>: &#123;</span><br><span class="line">                    <span class="string">&#x27;description&#x27;</span>: <span class="string">&#x27;OK&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;content&#x27;</span>: &#123;<span class="string">&#x27;application/json&#x27;</span>: &#123;</span><br><span class="line">                        <span class="string">&#x27;schema&#x27;</span>: PydanticSchema(schema_class=CreateUserResponse),</span><br><span class="line">                    &#125;&#125;,</span><br><span class="line">                &#125;&#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br><span class="line">api = construct_open_api_with_schema_class(api)</span><br><span class="line"><span class="built_in">print</span>(api.model_dump_json(by_alias=<span class="literal">True</span>, exclude_none=<span class="literal">True</span>, indent=<span class="number">2</span>))</span><br></pre></td></tr></table></figure>

<p>The generated file is similar to the previous one, except that it is written in JSON and schemas are embedded in the <code>components</code> section.</p>
<h3 id="Decorate-API-endpoints"><a href="#Decorate-API-endpoints" class="headerlink" title="Decorate API endpoints"></a>Decorate API endpoints</h3><p><a target="_blank" rel="noopener" href="https://github.com/0b01001001/spectree">SpecTree</a> provides facilities to decorate Flask view methods with Pydantic models. It generates OpenAPI docs in <a target="_blank" rel="noopener" href="http://localhost:5000/apidoc/swagger">http://localhost:5000/apidoc/swagger</a>.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">app = Flask(__name__)</span><br><span class="line">spec = SpecTree(<span class="string">&#x27;flask&#x27;</span>, annotations=<span class="literal">True</span>)</span><br><span class="line">spec.register(app)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&#x27;/create-user&#x27;</span></span>)</span></span><br><span class="line"><span class="meta">@spec.validate(<span class="params">resp=Response(<span class="params">HTTP_200=CreateUserResponse</span>)</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_user</span>(<span class="params">json: UserForm</span>) -&gt; CreateUserResponse:</span><br><span class="line">    user_orm = UserOrm(username=json.username, password=json.username)</span><br><span class="line">    <span class="keyword">return</span> CreateUserResponse(<span class="built_in">id</span>=user_orm.<span class="built_in">id</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>Pydantic <code>BaseModel</code> needs to be imported from <code>pydantic.v1</code>, for compatibility reason.</li>
<li>Validation error is returned to client as HTTP 422 UNPROCESSABLE ENTITY, with detailed information.</li>
</ul>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li><a target="_blank" rel="noopener" href="https://docs.pydantic.dev/latest/concepts/models/">https://docs.pydantic.dev/latest/concepts/models/</a></li>
<li><a target="_blank" rel="noopener" href="https://fastapi.tiangolo.com/tutorial/">https://fastapi.tiangolo.com/tutorial/</a></li>
<li><a target="_blank" rel="noopener" href="https://swagger.io/docs/specification/data-models/">https://swagger.io/docs/specification/data-models/</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://shzhangji.com/blog/2024/01/28/define-api-data-models-with-pydantic/" data-id="clrxd7dd4003senq15o4pe7ae" class="article-share-link">Share</a>
      
        <a href="https://shzhangji.com/blog/2024/01/28/define-api-data-models-with-pydantic/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/flask/" rel="tag">flask</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/openapi/" rel="tag">openapi</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pydantic/" rel="tag">pydantic</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/" rel="tag">python</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/blog/2024/01/19/python-static-type-check/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Python Static Type Check</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/algorithm/" style="font-size: 10px;">algorithm</a> <a href="/tags/analytics/" style="font-size: 14.29px;">analytics</a> <a href="/tags/apache-beam/" style="font-size: 10px;">apache beam</a> <a href="/tags/bootstrap/" style="font-size: 10px;">bootstrap</a> <a href="/tags/canal/" style="font-size: 10px;">canal</a> <a href="/tags/ci/" style="font-size: 10px;">ci</a> <a href="/tags/clojure/" style="font-size: 10px;">clojure</a> <a href="/tags/connect/" style="font-size: 10px;">connect</a> <a href="/tags/crossfilter/" style="font-size: 10px;">crossfilter</a> <a href="/tags/dc-js/" style="font-size: 10px;">dc.js</a> <a href="/tags/devops/" style="font-size: 10px;">devops</a> <a href="/tags/docker/" style="font-size: 10px;">docker</a> <a href="/tags/eclipse/" style="font-size: 10px;">eclipse</a> <a href="/tags/elasticsearch/" style="font-size: 10px;">elasticsearch</a> <a href="/tags/es6/" style="font-size: 10px;">es6</a> <a href="/tags/eslint/" style="font-size: 11.43px;">eslint</a> <a href="/tags/etl/" style="font-size: 12.86px;">etl</a> <a href="/tags/flask/" style="font-size: 14.29px;">flask</a> <a href="/tags/flink/" style="font-size: 11.43px;">flink</a> <a href="/tags/flume/" style="font-size: 12.86px;">flume</a> <a href="/tags/frontend/" style="font-size: 17.14px;">frontend</a> <a href="/tags/functional-programming/" style="font-size: 10px;">functional programming</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/github/" style="font-size: 11.43px;">github</a> <a href="/tags/hadoop/" style="font-size: 10px;">hadoop</a> <a href="/tags/hbase/" style="font-size: 10px;">hbase</a> <a href="/tags/hdfs/" style="font-size: 11.43px;">hdfs</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/hive/" style="font-size: 11.43px;">hive</a> <a href="/tags/java/" style="font-size: 18.57px;">java</a> <a href="/tags/javascript/" style="font-size: 15.71px;">javascript</a> <a href="/tags/kafka/" style="font-size: 11.43px;">kafka</a> <a href="/tags/kubernetes/" style="font-size: 11.43px;">kubernetes</a> <a href="/tags/lodash/" style="font-size: 11.43px;">lodash</a> <a href="/tags/machine-learning/" style="font-size: 10px;">machine learning</a> <a href="/tags/mapreduce/" style="font-size: 10px;">mapreduce</a> <a href="/tags/mypy/" style="font-size: 10px;">mypy</a> <a href="/tags/mysql/" style="font-size: 10px;">mysql</a> <a href="/tags/openapi/" style="font-size: 11.43px;">openapi</a> <a href="/tags/ops/" style="font-size: 10px;">ops</a> <a href="/tags/pandas/" style="font-size: 11.43px;">pandas</a> <a href="/tags/parcel/" style="font-size: 10px;">parcel</a> <a href="/tags/pinia/" style="font-size: 10px;">pinia</a> <a href="/tags/pip/" style="font-size: 10px;">pip</a> <a href="/tags/poetry/" style="font-size: 10px;">poetry</a> <a href="/tags/prometheus/" style="font-size: 10px;">prometheus</a> <a href="/tags/pydantic/" style="font-size: 10px;">pydantic</a> <a href="/tags/python/" style="font-size: 20px;">python</a> <a href="/tags/react/" style="font-size: 10px;">react</a> <a href="/tags/restful/" style="font-size: 11.43px;">restful</a> <a href="/tags/scala/" style="font-size: 11.43px;">scala</a> <a href="/tags/scalatra/" style="font-size: 10px;">scalatra</a> <a href="/tags/source-code/" style="font-size: 10px;">source code</a> <a href="/tags/spark/" style="font-size: 14.29px;">spark</a> <a href="/tags/spark-streaming/" style="font-size: 10px;">spark streaming</a> <a href="/tags/spring/" style="font-size: 12.86px;">spring</a> <a href="/tags/spring-boot/" style="font-size: 11.43px;">spring boot</a> <a href="/tags/spring-security/" style="font-size: 10px;">spring security</a> <a href="/tags/sql/" style="font-size: 11.43px;">sql</a> <a href="/tags/sqlalchemy/" style="font-size: 11.43px;">sqlalchemy</a> <a href="/tags/stream-processing/" style="font-size: 12.86px;">stream processing</a> <a href="/tags/tensorflow/" style="font-size: 10px;">tensorflow</a> <a href="/tags/thrift/" style="font-size: 10px;">thrift</a> <a href="/tags/typescript/" style="font-size: 12.86px;">typescript</a> <a href="/tags/vite/" style="font-size: 10px;">vite</a> <a href="/tags/vue/" style="font-size: 15.71px;">vue</a> <a href="/tags/vuex/" style="font-size: 10px;">vuex</a> <a href="/tags/webjars/" style="font-size: 10px;">webjars</a> <a href="/tags/webpack/" style="font-size: 10px;">webpack</a> <a href="/tags/websocket/" style="font-size: 10px;">websocket</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/01/">January 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">February 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">January 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">August 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">July 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">June 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">September 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">May 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04/">April 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/05/">May 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/10/">October 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/04/">April 2013</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/blog/2024/01/28/define-api-data-models-with-pydantic/">Define API Data Models with Pydantic</a>
          </li>
        
          <li>
            <a href="/blog/2024/01/19/python-static-type-check/">Python Static Type Check</a>
          </li>
        
          <li>
            <a href="/blog/2024/01/05/migrate-from-pip-requirements-txt-to-poetry/">Migrate from Pip requirements.txt to Poetry</a>
          </li>
        
          <li>
            <a href="/blog/2023/02/13/setup-ci-with-github-actions-java-node-python/">Setup CI with GitHub Actions (Java/Node/Python)</a>
          </li>
        
          <li>
            <a href="/blog/2023/01/15/restful-api-authentication-with-spring-security/">RESTful API Authentication with Spring Security</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      <a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://mirrors.creativecommons.org/presskit/buttons/80x15/svg/by-nc-sa.svg"></a>
      <br>
      &copy; 2024 Ji ZHANG<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/categories/Big-Data" class="mobile-nav-link">Big Data</a>
  
    <a href="/categories/Programming" class="mobile-nav-link">Programming</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>

    
<script>
  var disqus_shortname = 'jizhang';
  
  var disqus_url = 'https://shzhangji.com/blog/2024/01/28/define-api-data-models-with-pydantic/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>



<script src="/js/jquery.min.js"></script>



  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>


  </div>
</body>
</html>